{"ast":null,"code":"import { isTensor2D, TfjsImageRecognitionBase } from 'tfjs-image-recognition-base';\nfunction extractorsFactory(weightMap, paramMappings) {\n  var extractWeightEntry = TfjsImageRecognitionBase.extractWeightEntryFactory(weightMap, paramMappings);\n  function extractScaleLayerParams(prefix) {\n    var weights = extractWeightEntry(prefix + \"/scale/weights\", 1);\n    var biases = extractWeightEntry(prefix + \"/scale/biases\", 1);\n    return {\n      weights: weights,\n      biases: biases\n    };\n  }\n  function extractConvLayerParams(prefix) {\n    var filters = extractWeightEntry(prefix + \"/conv/filters\", 4);\n    var bias = extractWeightEntry(prefix + \"/conv/bias\", 1);\n    var scale = extractScaleLayerParams(prefix);\n    return {\n      conv: {\n        filters: filters,\n        bias: bias\n      },\n      scale: scale\n    };\n  }\n  function extractResidualLayerParams(prefix) {\n    return {\n      conv1: extractConvLayerParams(prefix + \"/conv1\"),\n      conv2: extractConvLayerParams(prefix + \"/conv2\")\n    };\n  }\n  return {\n    extractConvLayerParams: extractConvLayerParams,\n    extractResidualLayerParams: extractResidualLayerParams\n  };\n}\nexport function extractParamsFromWeigthMap(weightMap) {\n  var paramMappings = [];\n  var _a = extractorsFactory(weightMap, paramMappings),\n    extractConvLayerParams = _a.extractConvLayerParams,\n    extractResidualLayerParams = _a.extractResidualLayerParams;\n  var conv32_down = extractConvLayerParams('conv32_down');\n  var conv32_1 = extractResidualLayerParams('conv32_1');\n  var conv32_2 = extractResidualLayerParams('conv32_2');\n  var conv32_3 = extractResidualLayerParams('conv32_3');\n  var conv64_down = extractResidualLayerParams('conv64_down');\n  var conv64_1 = extractResidualLayerParams('conv64_1');\n  var conv64_2 = extractResidualLayerParams('conv64_2');\n  var conv64_3 = extractResidualLayerParams('conv64_3');\n  var conv128_down = extractResidualLayerParams('conv128_down');\n  var conv128_1 = extractResidualLayerParams('conv128_1');\n  var conv128_2 = extractResidualLayerParams('conv128_2');\n  var conv256_down = extractResidualLayerParams('conv256_down');\n  var conv256_1 = extractResidualLayerParams('conv256_1');\n  var conv256_2 = extractResidualLayerParams('conv256_2');\n  var conv256_down_out = extractResidualLayerParams('conv256_down_out');\n  var fc = weightMap['fc'];\n  paramMappings.push({\n    originalPath: 'fc',\n    paramPath: 'fc'\n  });\n  if (!isTensor2D(fc)) {\n    throw new Error(\"expected weightMap[fc] to be a Tensor2D, instead have \" + fc);\n  }\n  var params = {\n    conv32_down: conv32_down,\n    conv32_1: conv32_1,\n    conv32_2: conv32_2,\n    conv32_3: conv32_3,\n    conv64_down: conv64_down,\n    conv64_1: conv64_1,\n    conv64_2: conv64_2,\n    conv64_3: conv64_3,\n    conv128_down: conv128_down,\n    conv128_1: conv128_1,\n    conv128_2: conv128_2,\n    conv256_down: conv256_down,\n    conv256_1: conv256_1,\n    conv256_2: conv256_2,\n    conv256_down_out: conv256_down_out,\n    fc: fc\n  };\n  TfjsImageRecognitionBase.disposeUnusedWeightTensors(weightMap, paramMappings);\n  return {\n    params: params,\n    paramMappings: paramMappings\n  };\n}","map":{"version":3,"names":["isTensor2D","TfjsImageRecognitionBase","extractorsFactory","weightMap","paramMappings","extractWeightEntry","extractWeightEntryFactory","extractScaleLayerParams","prefix","weights","biases","extractConvLayerParams","filters","bias","scale","conv","extractResidualLayerParams","conv1","conv2","extractParamsFromWeigthMap","_a","conv32_down","conv32_1","conv32_2","conv32_3","conv64_down","conv64_1","conv64_2","conv64_3","conv128_down","conv128_1","conv128_2","conv256_down","conv256_1","conv256_2","conv256_down_out","fc","push","originalPath","paramPath","Error","params","disposeUnusedWeightTensors"],"sources":["/Users/dhanya/node_modules/face-api.js/src/faceRecognitionNet/extractParamsFromWeigthMap.ts"],"sourcesContent":["import * as tf from '@tensorflow/tfjs-core';\r\nimport { isTensor2D, TfjsImageRecognitionBase } from 'tfjs-image-recognition-base';\r\n\r\nimport { ConvLayerParams, NetParams, ResidualLayerParams, ScaleLayerParams } from './types';\r\n\r\nfunction extractorsFactory(weightMap: any, paramMappings: TfjsImageRecognitionBase.ParamMapping[]) {\r\n\r\n  const extractWeightEntry = TfjsImageRecognitionBase.extractWeightEntryFactory(weightMap, paramMappings)\r\n\r\n  function extractScaleLayerParams(prefix: string): ScaleLayerParams {\r\n\r\n    const weights = extractWeightEntry<tf.Tensor1D>(`${prefix}/scale/weights`, 1)\r\n    const biases = extractWeightEntry<tf.Tensor1D>(`${prefix}/scale/biases`, 1)\r\n\r\n    return { weights, biases }\r\n  }\r\n\r\n  function extractConvLayerParams(prefix: string): ConvLayerParams {\r\n\r\n    const filters = extractWeightEntry<tf.Tensor4D>(`${prefix}/conv/filters`, 4)\r\n    const bias = extractWeightEntry<tf.Tensor1D>(`${prefix}/conv/bias`, 1)\r\n    const scale = extractScaleLayerParams(prefix)\r\n\r\n    return { conv: { filters, bias }, scale }\r\n  }\r\n\r\n  function extractResidualLayerParams(prefix: string): ResidualLayerParams {\r\n    return {\r\n      conv1: extractConvLayerParams(`${prefix}/conv1`),\r\n      conv2: extractConvLayerParams(`${prefix}/conv2`)\r\n    }\r\n  }\r\n\r\n  return {\r\n    extractConvLayerParams,\r\n    extractResidualLayerParams\r\n  }\r\n\r\n}\r\n\r\nexport function extractParamsFromWeigthMap(\r\n  weightMap: tf.NamedTensorMap\r\n): { params: NetParams, paramMappings: TfjsImageRecognitionBase.ParamMapping[] } {\r\n\r\n  const paramMappings: TfjsImageRecognitionBase.ParamMapping[] = []\r\n\r\n  const {\r\n    extractConvLayerParams,\r\n    extractResidualLayerParams\r\n  } = extractorsFactory(weightMap, paramMappings)\r\n\r\n  const conv32_down = extractConvLayerParams('conv32_down')\r\n  const conv32_1 = extractResidualLayerParams('conv32_1')\r\n  const conv32_2 = extractResidualLayerParams('conv32_2')\r\n  const conv32_3 = extractResidualLayerParams('conv32_3')\r\n\r\n  const conv64_down = extractResidualLayerParams('conv64_down')\r\n  const conv64_1 = extractResidualLayerParams('conv64_1')\r\n  const conv64_2 = extractResidualLayerParams('conv64_2')\r\n  const conv64_3 = extractResidualLayerParams('conv64_3')\r\n\r\n  const conv128_down = extractResidualLayerParams('conv128_down')\r\n  const conv128_1 = extractResidualLayerParams('conv128_1')\r\n  const conv128_2 = extractResidualLayerParams('conv128_2')\r\n\r\n  const conv256_down = extractResidualLayerParams('conv256_down')\r\n  const conv256_1 = extractResidualLayerParams('conv256_1')\r\n  const conv256_2 = extractResidualLayerParams('conv256_2')\r\n  const conv256_down_out = extractResidualLayerParams('conv256_down_out')\r\n\r\n  const fc = weightMap['fc']\r\n  paramMappings.push({ originalPath: 'fc', paramPath: 'fc' })\r\n\r\n  if (!isTensor2D(fc)) {\r\n    throw new Error(`expected weightMap[fc] to be a Tensor2D, instead have ${fc}`)\r\n  }\r\n\r\n  const params = {\r\n    conv32_down,\r\n    conv32_1,\r\n    conv32_2,\r\n    conv32_3,\r\n    conv64_down,\r\n    conv64_1,\r\n    conv64_2,\r\n    conv64_3,\r\n    conv128_down,\r\n    conv128_1,\r\n    conv128_2,\r\n    conv256_down,\r\n    conv256_1,\r\n    conv256_2,\r\n    conv256_down_out,\r\n    fc\r\n  }\r\n\r\n  TfjsImageRecognitionBase.disposeUnusedWeightTensors(weightMap, paramMappings)\r\n\r\n  return { params, paramMappings }\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}