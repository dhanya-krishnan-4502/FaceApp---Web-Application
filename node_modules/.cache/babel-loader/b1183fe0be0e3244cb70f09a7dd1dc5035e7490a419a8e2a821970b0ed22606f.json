{"ast":null,"code":"import * as tf from '@tensorflow/tfjs-core';\nimport { isFloat, TfjsImageRecognitionBase } from 'tfjs-image-recognition-base';\nfunction extractorsFactory(extractWeights, paramMappings) {\n  function extractFilterValues(numFilterValues, numFilters, filterSize) {\n    var weights = extractWeights(numFilterValues);\n    var depth = weights.length / (numFilters * filterSize * filterSize);\n    if (isFloat(depth)) {\n      throw new Error(\"depth has to be an integer: \" + depth + \", weights.length: \" + weights.length + \", numFilters: \" + numFilters + \", filterSize: \" + filterSize);\n    }\n    return tf.tidy(function () {\n      return tf.transpose(tf.tensor4d(weights, [numFilters, depth, filterSize, filterSize]), [2, 3, 1, 0]);\n    });\n  }\n  function extractConvParams(numFilterValues, numFilters, filterSize, mappedPrefix) {\n    var filters = extractFilterValues(numFilterValues, numFilters, filterSize);\n    var bias = tf.tensor1d(extractWeights(numFilters));\n    paramMappings.push({\n      paramPath: mappedPrefix + \"/filters\"\n    }, {\n      paramPath: mappedPrefix + \"/bias\"\n    });\n    return {\n      filters: filters,\n      bias: bias\n    };\n  }\n  function extractScaleLayerParams(numWeights, mappedPrefix) {\n    var weights = tf.tensor1d(extractWeights(numWeights));\n    var biases = tf.tensor1d(extractWeights(numWeights));\n    paramMappings.push({\n      paramPath: mappedPrefix + \"/weights\"\n    }, {\n      paramPath: mappedPrefix + \"/biases\"\n    });\n    return {\n      weights: weights,\n      biases: biases\n    };\n  }\n  function extractConvLayerParams(numFilterValues, numFilters, filterSize, mappedPrefix) {\n    var conv = extractConvParams(numFilterValues, numFilters, filterSize, mappedPrefix + \"/conv\");\n    var scale = extractScaleLayerParams(numFilters, mappedPrefix + \"/scale\");\n    return {\n      conv: conv,\n      scale: scale\n    };\n  }\n  function extractResidualLayerParams(numFilterValues, numFilters, filterSize, mappedPrefix, isDown) {\n    if (isDown === void 0) {\n      isDown = false;\n    }\n    var conv1 = extractConvLayerParams((isDown ? 0.5 : 1) * numFilterValues, numFilters, filterSize, mappedPrefix + \"/conv1\");\n    var conv2 = extractConvLayerParams(numFilterValues, numFilters, filterSize, mappedPrefix + \"/conv2\");\n    return {\n      conv1: conv1,\n      conv2: conv2\n    };\n  }\n  return {\n    extractConvLayerParams: extractConvLayerParams,\n    extractResidualLayerParams: extractResidualLayerParams\n  };\n}\nexport function extractParams(weights) {\n  var _a = TfjsImageRecognitionBase.extractWeightsFactory(weights),\n    extractWeights = _a.extractWeights,\n    getRemainingWeights = _a.getRemainingWeights;\n  var paramMappings = [];\n  var _b = extractorsFactory(extractWeights, paramMappings),\n    extractConvLayerParams = _b.extractConvLayerParams,\n    extractResidualLayerParams = _b.extractResidualLayerParams;\n  var conv32_down = extractConvLayerParams(4704, 32, 7, 'conv32_down');\n  var conv32_1 = extractResidualLayerParams(9216, 32, 3, 'conv32_1');\n  var conv32_2 = extractResidualLayerParams(9216, 32, 3, 'conv32_2');\n  var conv32_3 = extractResidualLayerParams(9216, 32, 3, 'conv32_3');\n  var conv64_down = extractResidualLayerParams(36864, 64, 3, 'conv64_down', true);\n  var conv64_1 = extractResidualLayerParams(36864, 64, 3, 'conv64_1');\n  var conv64_2 = extractResidualLayerParams(36864, 64, 3, 'conv64_2');\n  var conv64_3 = extractResidualLayerParams(36864, 64, 3, 'conv64_3');\n  var conv128_down = extractResidualLayerParams(147456, 128, 3, 'conv128_down', true);\n  var conv128_1 = extractResidualLayerParams(147456, 128, 3, 'conv128_1');\n  var conv128_2 = extractResidualLayerParams(147456, 128, 3, 'conv128_2');\n  var conv256_down = extractResidualLayerParams(589824, 256, 3, 'conv256_down', true);\n  var conv256_1 = extractResidualLayerParams(589824, 256, 3, 'conv256_1');\n  var conv256_2 = extractResidualLayerParams(589824, 256, 3, 'conv256_2');\n  var conv256_down_out = extractResidualLayerParams(589824, 256, 3, 'conv256_down_out');\n  var fc = tf.tidy(function () {\n    return tf.transpose(tf.tensor2d(extractWeights(256 * 128), [128, 256]), [1, 0]);\n  });\n  paramMappings.push({\n    paramPath: \"fc\"\n  });\n  if (getRemainingWeights().length !== 0) {\n    throw new Error(\"weights remaing after extract: \" + getRemainingWeights().length);\n  }\n  var params = {\n    conv32_down: conv32_down,\n    conv32_1: conv32_1,\n    conv32_2: conv32_2,\n    conv32_3: conv32_3,\n    conv64_down: conv64_down,\n    conv64_1: conv64_1,\n    conv64_2: conv64_2,\n    conv64_3: conv64_3,\n    conv128_down: conv128_down,\n    conv128_1: conv128_1,\n    conv128_2: conv128_2,\n    conv256_down: conv256_down,\n    conv256_1: conv256_1,\n    conv256_2: conv256_2,\n    conv256_down_out: conv256_down_out,\n    fc: fc\n  };\n  return {\n    params: params,\n    paramMappings: paramMappings\n  };\n}","map":{"version":3,"names":["tf","isFloat","TfjsImageRecognitionBase","extractorsFactory","extractWeights","paramMappings","extractFilterValues","numFilterValues","numFilters","filterSize","weights","depth","length","Error","tidy","transpose","tensor4d","extractConvParams","mappedPrefix","filters","bias","tensor1d","push","paramPath","extractScaleLayerParams","numWeights","biases","extractConvLayerParams","conv","scale","extractResidualLayerParams","isDown","conv1","conv2","extractParams","_a","extractWeightsFactory","getRemainingWeights","_b","conv32_down","conv32_1","conv32_2","conv32_3","conv64_down","conv64_1","conv64_2","conv64_3","conv128_down","conv128_1","conv128_2","conv256_down","conv256_1","conv256_2","conv256_down_out","fc","tensor2d","params"],"sources":["/Users/dhanya/node_modules/face-api.js/src/faceRecognitionNet/extractParams.ts"],"sourcesContent":["import * as tf from '@tensorflow/tfjs-core';\r\nimport { isFloat, TfjsImageRecognitionBase } from 'tfjs-image-recognition-base';\r\n\r\nimport { ConvLayerParams, NetParams, ResidualLayerParams, ScaleLayerParams } from './types';\r\n\r\nfunction extractorsFactory(extractWeights: TfjsImageRecognitionBase.ExtractWeightsFunction, paramMappings: TfjsImageRecognitionBase.ParamMapping[]) {\r\n\r\n  function extractFilterValues(numFilterValues: number, numFilters: number, filterSize: number): tf.Tensor4D {\r\n    const weights = extractWeights(numFilterValues)\r\n    const depth = weights.length / (numFilters * filterSize * filterSize)\r\n\r\n    if (isFloat(depth)) {\r\n      throw new Error(`depth has to be an integer: ${depth}, weights.length: ${weights.length}, numFilters: ${numFilters}, filterSize: ${filterSize}`)\r\n    }\r\n\r\n    return tf.tidy(\r\n      () => tf.transpose(\r\n        tf.tensor4d(weights, [numFilters, depth, filterSize, filterSize]),\r\n        [2, 3, 1, 0]\r\n      )\r\n    )\r\n  }\r\n\r\n  function extractConvParams(\r\n    numFilterValues: number,\r\n    numFilters: number,\r\n    filterSize: number,\r\n    mappedPrefix: string\r\n  ): TfjsImageRecognitionBase.ConvParams {\r\n\r\n    const filters = extractFilterValues(numFilterValues, numFilters, filterSize)\r\n    const bias = tf.tensor1d(extractWeights(numFilters))\r\n\r\n    paramMappings.push(\r\n      { paramPath: `${mappedPrefix}/filters` },\r\n      { paramPath: `${mappedPrefix}/bias` }\r\n    )\r\n\r\n    return { filters, bias }\r\n  }\r\n\r\n  function extractScaleLayerParams(numWeights: number, mappedPrefix: string): ScaleLayerParams {\r\n\r\n    const weights = tf.tensor1d(extractWeights(numWeights))\r\n    const biases = tf.tensor1d(extractWeights(numWeights))\r\n\r\n    paramMappings.push(\r\n      { paramPath: `${mappedPrefix}/weights` },\r\n      { paramPath: `${mappedPrefix}/biases` }\r\n    )\r\n\r\n    return {\r\n      weights,\r\n      biases\r\n    }\r\n  }\r\n\r\n  function extractConvLayerParams(\r\n    numFilterValues: number,\r\n    numFilters: number,\r\n    filterSize: number,\r\n    mappedPrefix: string\r\n  ): ConvLayerParams {\r\n\r\n    const conv = extractConvParams(numFilterValues, numFilters, filterSize, `${mappedPrefix}/conv`)\r\n    const scale = extractScaleLayerParams(numFilters, `${mappedPrefix}/scale`)\r\n\r\n    return { conv, scale }\r\n  }\r\n\r\n  function extractResidualLayerParams(\r\n    numFilterValues: number,\r\n    numFilters: number,\r\n    filterSize: number,\r\n    mappedPrefix: string,\r\n    isDown: boolean = false\r\n  ): ResidualLayerParams {\r\n\r\n    const conv1 = extractConvLayerParams((isDown ? 0.5 : 1) * numFilterValues, numFilters, filterSize, `${mappedPrefix}/conv1`)\r\n    const conv2 = extractConvLayerParams(numFilterValues, numFilters, filterSize, `${mappedPrefix}/conv2`)\r\n\r\n    return { conv1, conv2 }\r\n  }\r\n\r\n  return {\r\n    extractConvLayerParams,\r\n    extractResidualLayerParams\r\n  }\r\n\r\n}\r\n\r\nexport function extractParams(weights: Float32Array): { params: NetParams, paramMappings: TfjsImageRecognitionBase.ParamMapping[] } {\r\n\r\n  const {\r\n    extractWeights,\r\n    getRemainingWeights\r\n  } = TfjsImageRecognitionBase.extractWeightsFactory(weights)\r\n\r\n  const paramMappings: TfjsImageRecognitionBase.ParamMapping[] = []\r\n\r\n  const {\r\n    extractConvLayerParams,\r\n    extractResidualLayerParams\r\n  } = extractorsFactory(extractWeights, paramMappings)\r\n\r\n  const conv32_down = extractConvLayerParams(4704, 32, 7, 'conv32_down')\r\n  const conv32_1 = extractResidualLayerParams(9216, 32, 3, 'conv32_1')\r\n  const conv32_2 = extractResidualLayerParams(9216, 32, 3, 'conv32_2')\r\n  const conv32_3 = extractResidualLayerParams(9216, 32, 3, 'conv32_3')\r\n\r\n  const conv64_down = extractResidualLayerParams(36864, 64, 3, 'conv64_down', true)\r\n  const conv64_1 = extractResidualLayerParams(36864, 64, 3, 'conv64_1')\r\n  const conv64_2 = extractResidualLayerParams(36864, 64, 3, 'conv64_2')\r\n  const conv64_3 = extractResidualLayerParams(36864, 64, 3, 'conv64_3')\r\n\r\n  const conv128_down = extractResidualLayerParams(147456, 128, 3, 'conv128_down', true)\r\n  const conv128_1 = extractResidualLayerParams(147456, 128, 3, 'conv128_1')\r\n  const conv128_2 = extractResidualLayerParams(147456, 128, 3, 'conv128_2')\r\n\r\n  const conv256_down = extractResidualLayerParams(589824, 256, 3, 'conv256_down', true)\r\n  const conv256_1 = extractResidualLayerParams(589824, 256, 3, 'conv256_1')\r\n  const conv256_2 = extractResidualLayerParams(589824, 256, 3, 'conv256_2')\r\n  const conv256_down_out = extractResidualLayerParams(589824, 256, 3, 'conv256_down_out')\r\n\r\n  const fc = tf.tidy(\r\n    () => tf.transpose(tf.tensor2d(extractWeights(256 * 128), [128, 256]), [1, 0])\r\n  )\r\n  paramMappings.push({ paramPath: `fc` })\r\n\r\n  if (getRemainingWeights().length !== 0) {\r\n    throw new Error(`weights remaing after extract: ${getRemainingWeights().length}`)\r\n  }\r\n\r\n  const params = {\r\n    conv32_down,\r\n    conv32_1,\r\n    conv32_2,\r\n    conv32_3,\r\n    conv64_down,\r\n    conv64_1,\r\n    conv64_2,\r\n    conv64_3,\r\n    conv128_down,\r\n    conv128_1,\r\n    conv128_2,\r\n    conv256_down,\r\n    conv256_1,\r\n    conv256_2,\r\n    conv256_down_out,\r\n    fc\r\n  }\r\n\r\n  return { params, paramMappings }\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}