{"ast":null,"code":"import * as tslib_1 from \"tslib\";\nimport { TfjsImageRecognitionBase } from 'tfjs-image-recognition-base';\nimport { extendWithFaceDetection } from '../factories/WithFaceDetection';\nimport { MtcnnOptions } from '../mtcnn/MtcnnOptions';\nimport { SsdMobilenetv1Options } from '../ssdMobilenetv1/SsdMobilenetv1Options';\nimport { TinyFaceDetectorOptions } from '../tinyFaceDetector/TinyFaceDetectorOptions';\nimport { ComposableTask } from './ComposableTask';\nimport { DetectAllFaceLandmarksTask, DetectSingleFaceLandmarksTask } from './DetectFaceLandmarksTasks';\nimport { nets } from './nets';\nimport { PredictAllAgeAndGenderTask, PredictSingleAgeAndGenderTask } from './PredictAgeAndGenderTask';\nimport { PredictAllFaceExpressionsTask, PredictSingleFaceExpressionsTask } from './PredictFaceExpressionsTask';\nvar DetectFacesTaskBase = /** @class */function (_super) {\n  tslib_1.__extends(DetectFacesTaskBase, _super);\n  function DetectFacesTaskBase(input, options) {\n    if (options === void 0) {\n      options = new SsdMobilenetv1Options();\n    }\n    var _this = _super.call(this) || this;\n    _this.input = input;\n    _this.options = options;\n    return _this;\n  }\n  return DetectFacesTaskBase;\n}(ComposableTask);\nexport { DetectFacesTaskBase };\nvar DetectAllFacesTask = /** @class */function (_super) {\n  tslib_1.__extends(DetectAllFacesTask, _super);\n  function DetectAllFacesTask() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  DetectAllFacesTask.prototype.run = function () {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var _a, input, options, faceDetectionFunction;\n      return tslib_1.__generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            _a = this, input = _a.input, options = _a.options;\n            if (!(options instanceof MtcnnOptions)) return [3 /*break*/, 2];\n            return [4 /*yield*/, nets.mtcnn.forward(input, options)];\n          case 1:\n            return [2 /*return*/, _b.sent().map(function (result) {\n              return result.detection;\n            })];\n          case 2:\n            faceDetectionFunction = options instanceof TinyFaceDetectorOptions ? function (input) {\n              return nets.tinyFaceDetector.locateFaces(input, options);\n            } : options instanceof SsdMobilenetv1Options ? function (input) {\n              return nets.ssdMobilenetv1.locateFaces(input, options);\n            } : options instanceof TfjsImageRecognitionBase.TinyYolov2Options ? function (input) {\n              return nets.tinyYolov2.locateFaces(input, options);\n            } : null;\n            if (!faceDetectionFunction) {\n              throw new Error('detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options');\n            }\n            return [2 /*return*/, faceDetectionFunction(input)];\n        }\n      });\n    });\n  };\n  DetectAllFacesTask.prototype.runAndExtendWithFaceDetections = function () {\n    var _this = this;\n    return new Promise(function (res) {\n      return tslib_1.__awaiter(_this, void 0, void 0, function () {\n        var detections;\n        return tslib_1.__generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              return [4 /*yield*/, this.run()];\n            case 1:\n              detections = _a.sent();\n              return [2 /*return*/, res(detections.map(function (detection) {\n                return extendWithFaceDetection({}, detection);\n              }))];\n          }\n        });\n      });\n    });\n  };\n  DetectAllFacesTask.prototype.withFaceLandmarks = function (useTinyLandmarkNet) {\n    if (useTinyLandmarkNet === void 0) {\n      useTinyLandmarkNet = false;\n    }\n    return new DetectAllFaceLandmarksTask(this.runAndExtendWithFaceDetections(), this.input, useTinyLandmarkNet);\n  };\n  DetectAllFacesTask.prototype.withFaceExpressions = function () {\n    return new PredictAllFaceExpressionsTask(this.runAndExtendWithFaceDetections(), this.input);\n  };\n  DetectAllFacesTask.prototype.withAgeAndGender = function () {\n    return new PredictAllAgeAndGenderTask(this.runAndExtendWithFaceDetections(), this.input);\n  };\n  return DetectAllFacesTask;\n}(DetectFacesTaskBase);\nexport { DetectAllFacesTask };\nvar DetectSingleFaceTask = /** @class */function (_super) {\n  tslib_1.__extends(DetectSingleFaceTask, _super);\n  function DetectSingleFaceTask() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  DetectSingleFaceTask.prototype.run = function () {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var faceDetections, faceDetectionWithHighestScore;\n      return tslib_1.__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, new DetectAllFacesTask(this.input, this.options)];\n          case 1:\n            faceDetections = _a.sent();\n            faceDetectionWithHighestScore = faceDetections[0];\n            faceDetections.forEach(function (faceDetection) {\n              if (faceDetection.score > faceDetectionWithHighestScore.score) {\n                faceDetectionWithHighestScore = faceDetection;\n              }\n            });\n            return [2 /*return*/, faceDetectionWithHighestScore];\n        }\n      });\n    });\n  };\n  DetectSingleFaceTask.prototype.runAndExtendWithFaceDetection = function () {\n    var _this = this;\n    return new Promise(function (res) {\n      return tslib_1.__awaiter(_this, void 0, void 0, function () {\n        var detection;\n        return tslib_1.__generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              return [4 /*yield*/, this.run()];\n            case 1:\n              detection = _a.sent();\n              return [2 /*return*/, res(detection ? extendWithFaceDetection({}, detection) : undefined)];\n          }\n        });\n      });\n    });\n  };\n  DetectSingleFaceTask.prototype.withFaceLandmarks = function (useTinyLandmarkNet) {\n    if (useTinyLandmarkNet === void 0) {\n      useTinyLandmarkNet = false;\n    }\n    return new DetectSingleFaceLandmarksTask(this.runAndExtendWithFaceDetection(), this.input, useTinyLandmarkNet);\n  };\n  DetectSingleFaceTask.prototype.withFaceExpressions = function () {\n    return new PredictSingleFaceExpressionsTask(this.runAndExtendWithFaceDetection(), this.input);\n  };\n  DetectSingleFaceTask.prototype.withAgeAndGender = function () {\n    return new PredictSingleAgeAndGenderTask(this.runAndExtendWithFaceDetection(), this.input);\n  };\n  return DetectSingleFaceTask;\n}(DetectFacesTaskBase);\nexport { DetectSingleFaceTask };","map":{"version":3,"names":["TfjsImageRecognitionBase","extendWithFaceDetection","MtcnnOptions","SsdMobilenetv1Options","TinyFaceDetectorOptions","ComposableTask","DetectAllFaceLandmarksTask","DetectSingleFaceLandmarksTask","nets","PredictAllAgeAndGenderTask","PredictSingleAgeAndGenderTask","PredictAllFaceExpressionsTask","PredictSingleFaceExpressionsTask","DetectFacesTaskBase","_super","tslib_1","__extends","input","options","_this","call","DetectAllFacesTask","prototype","run","_a","mtcnn","forward","_b","sent","map","result","detection","faceDetectionFunction","tinyFaceDetector","locateFaces","ssdMobilenetv1","TinyYolov2Options","tinyYolov2","Error","runAndExtendWithFaceDetections","Promise","res","__awaiter","detections","withFaceLandmarks","useTinyLandmarkNet","withFaceExpressions","withAgeAndGender","DetectSingleFaceTask","faceDetections","faceDetectionWithHighestScore","forEach","faceDetection","score","runAndExtendWithFaceDetection","undefined"],"sources":["/Users/dhanya/node_modules/face-api.js/src/globalApi/DetectFacesTasks.ts"],"sourcesContent":["import { TfjsImageRecognitionBase, TNetInput } from 'tfjs-image-recognition-base';\r\n\r\nimport { FaceDetection } from '../classes/FaceDetection';\r\nimport { extendWithFaceDetection, WithFaceDetection } from '../factories/WithFaceDetection';\r\nimport { MtcnnOptions } from '../mtcnn/MtcnnOptions';\r\nimport { SsdMobilenetv1Options } from '../ssdMobilenetv1/SsdMobilenetv1Options';\r\nimport { TinyFaceDetectorOptions } from '../tinyFaceDetector/TinyFaceDetectorOptions';\r\nimport { ComposableTask } from './ComposableTask';\r\nimport { DetectAllFaceLandmarksTask, DetectSingleFaceLandmarksTask } from './DetectFaceLandmarksTasks';\r\nimport { nets } from './nets';\r\nimport { PredictAllAgeAndGenderTask, PredictSingleAgeAndGenderTask } from './PredictAgeAndGenderTask';\r\nimport { PredictAllFaceExpressionsTask, PredictSingleFaceExpressionsTask } from './PredictFaceExpressionsTask';\r\nimport { FaceDetectionOptions } from './types';\r\n\r\nexport class DetectFacesTaskBase<TReturn> extends ComposableTask<TReturn> {\r\n  constructor(\r\n    protected input: TNetInput,\r\n    protected options: FaceDetectionOptions = new SsdMobilenetv1Options()\r\n  ) {\r\n    super()\r\n  }\r\n}\r\n\r\nexport class DetectAllFacesTask extends DetectFacesTaskBase<FaceDetection[]> {\r\n\r\n  public async run(): Promise<FaceDetection[]> {\r\n\r\n    const { input, options } = this\r\n\r\n    if (options instanceof MtcnnOptions) {\r\n      return (await nets.mtcnn.forward(input, options))\r\n        .map(result => result.detection)\r\n    }\r\n\r\n    const faceDetectionFunction = options instanceof TinyFaceDetectorOptions\r\n      ? (input: TNetInput) => nets.tinyFaceDetector.locateFaces(input, options)\r\n      : (\r\n        options instanceof SsdMobilenetv1Options\r\n          ? (input: TNetInput) => nets.ssdMobilenetv1.locateFaces(input, options)\r\n          : (\r\n            options instanceof TfjsImageRecognitionBase.TinyYolov2Options\r\n              ? (input: TNetInput) => nets.tinyYolov2.locateFaces(input, options)\r\n              : null\r\n          )\r\n      )\r\n\r\n    if (!faceDetectionFunction) {\r\n      throw new Error('detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options')\r\n    }\r\n\r\n    return faceDetectionFunction(input)\r\n  }\r\n\r\n  private runAndExtendWithFaceDetections(): Promise<WithFaceDetection<{}>[]> {\r\n    return new Promise<WithFaceDetection<{}>[]>(async res => {\r\n      const detections = await this.run()\r\n      return res(detections.map(detection => extendWithFaceDetection({}, detection)))\r\n    })\r\n  }\r\n\r\n  withFaceLandmarks(useTinyLandmarkNet: boolean = false) {\r\n    return new DetectAllFaceLandmarksTask(\r\n      this.runAndExtendWithFaceDetections(),\r\n      this.input,\r\n      useTinyLandmarkNet\r\n    )\r\n  }\r\n\r\n  withFaceExpressions() {\r\n    return new PredictAllFaceExpressionsTask (\r\n      this.runAndExtendWithFaceDetections(),\r\n      this.input\r\n    )\r\n  }\r\n\r\n  withAgeAndGender() {\r\n    return new PredictAllAgeAndGenderTask(\r\n      this.runAndExtendWithFaceDetections(),\r\n      this.input\r\n    )\r\n  }\r\n}\r\n\r\nexport class DetectSingleFaceTask extends DetectFacesTaskBase<FaceDetection | undefined> {\r\n\r\n  public async run(): Promise<FaceDetection | undefined> {\r\n    const faceDetections = await new DetectAllFacesTask(this.input, this.options);\r\n    let faceDetectionWithHighestScore = faceDetections[0];\r\n    faceDetections.forEach(faceDetection => {\r\n      if (faceDetection.score > faceDetectionWithHighestScore.score) {\r\n        faceDetectionWithHighestScore = faceDetection;\r\n      }\r\n    });\r\n    return faceDetectionWithHighestScore;\r\n  }\r\n\r\n  private runAndExtendWithFaceDetection(): Promise<WithFaceDetection<{}>> {\r\n    return new Promise<WithFaceDetection<{}>>(async res => {\r\n      const detection = await this.run()\r\n      return res(detection ? extendWithFaceDetection<{}>({}, detection) : undefined)\r\n    })\r\n  }\r\n\r\n  withFaceLandmarks(useTinyLandmarkNet: boolean = false) {\r\n    return new DetectSingleFaceLandmarksTask(\r\n      this.runAndExtendWithFaceDetection(),\r\n      this.input,\r\n      useTinyLandmarkNet\r\n    )\r\n  }\r\n\r\n  withFaceExpressions() {\r\n    return new PredictSingleFaceExpressionsTask(\r\n      this.runAndExtendWithFaceDetection(),\r\n      this.input\r\n    )\r\n  }\r\n\r\n  withAgeAndGender() {\r\n    return new PredictSingleAgeAndGenderTask(\r\n      this.runAndExtendWithFaceDetection(),\r\n      this.input\r\n    )\r\n  }\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}