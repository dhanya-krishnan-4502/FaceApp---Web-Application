{"ast":null,"code":"import * as tslib_1 from \"tslib\";\nimport * as tf from '@tensorflow/tfjs-core';\nimport { NeuralNetwork, normalize, toNetInput } from 'tfjs-image-recognition-base';\nimport { denseBlock3 } from './denseBlock';\nimport { extractParamsFromWeigthMapTiny } from './extractParamsFromWeigthMapTiny';\nimport { extractParamsTiny } from './extractParamsTiny';\nvar TinyFaceFeatureExtractor = /** @class */function (_super) {\n  tslib_1.__extends(TinyFaceFeatureExtractor, _super);\n  function TinyFaceFeatureExtractor() {\n    return _super.call(this, 'TinyFaceFeatureExtractor') || this;\n  }\n  TinyFaceFeatureExtractor.prototype.forwardInput = function (input) {\n    var params = this.params;\n    if (!params) {\n      throw new Error('TinyFaceFeatureExtractor - load model before inference');\n    }\n    return tf.tidy(function () {\n      var batchTensor = input.toBatchTensor(112, true);\n      var meanRgb = [122.782, 117.001, 104.298];\n      var normalized = normalize(batchTensor, meanRgb).div(tf.scalar(255));\n      var out = denseBlock3(normalized, params.dense0, true);\n      out = denseBlock3(out, params.dense1);\n      out = denseBlock3(out, params.dense2);\n      out = tf.avgPool(out, [14, 14], [2, 2], 'valid');\n      return out;\n    });\n  };\n  TinyFaceFeatureExtractor.prototype.forward = function (input) {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var _a;\n      return tslib_1.__generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            _a = this.forwardInput;\n            return [4 /*yield*/, toNetInput(input)];\n          case 1:\n            return [2 /*return*/, _a.apply(this, [_b.sent()])];\n        }\n      });\n    });\n  };\n  TinyFaceFeatureExtractor.prototype.getDefaultModelName = function () {\n    return 'face_feature_extractor_tiny_model';\n  };\n  TinyFaceFeatureExtractor.prototype.extractParamsFromWeigthMap = function (weightMap) {\n    return extractParamsFromWeigthMapTiny(weightMap);\n  };\n  TinyFaceFeatureExtractor.prototype.extractParams = function (weights) {\n    return extractParamsTiny(weights);\n  };\n  return TinyFaceFeatureExtractor;\n}(NeuralNetwork);\nexport { TinyFaceFeatureExtractor };","map":{"version":3,"names":["tf","NeuralNetwork","normalize","toNetInput","denseBlock3","extractParamsFromWeigthMapTiny","extractParamsTiny","TinyFaceFeatureExtractor","_super","tslib_1","__extends","call","prototype","forwardInput","input","params","Error","tidy","batchTensor","toBatchTensor","meanRgb","normalized","div","scalar","out","dense0","dense1","dense2","avgPool","forward","_a","apply","_b","sent","getDefaultModelName","extractParamsFromWeigthMap","weightMap","extractParams","weights"],"sources":["/Users/dhanya/node_modules/face-api.js/src/faceFeatureExtractor/TinyFaceFeatureExtractor.ts"],"sourcesContent":["import * as tf from '@tensorflow/tfjs-core';\r\nimport { NetInput, NeuralNetwork, normalize, TNetInput, toNetInput } from 'tfjs-image-recognition-base';\r\n\r\nimport { denseBlock3 } from './denseBlock';\r\nimport { extractParamsFromWeigthMapTiny } from './extractParamsFromWeigthMapTiny';\r\nimport { extractParamsTiny } from './extractParamsTiny';\r\nimport { IFaceFeatureExtractor, TinyFaceFeatureExtractorParams } from './types';\r\n\r\nexport class TinyFaceFeatureExtractor extends NeuralNetwork<TinyFaceFeatureExtractorParams> implements IFaceFeatureExtractor<TinyFaceFeatureExtractorParams> {\r\n\r\n  constructor() {\r\n    super('TinyFaceFeatureExtractor')\r\n  }\r\n\r\n  public forwardInput(input: NetInput): tf.Tensor4D {\r\n\r\n    const { params } = this\r\n\r\n    if (!params) {\r\n      throw new Error('TinyFaceFeatureExtractor - load model before inference')\r\n    }\r\n\r\n    return tf.tidy(() => {\r\n      const batchTensor = input.toBatchTensor(112, true)\r\n      const meanRgb = [122.782, 117.001, 104.298]\r\n      const normalized = normalize(batchTensor, meanRgb).div(tf.scalar(255)) as tf.Tensor4D\r\n\r\n      let out = denseBlock3(normalized, params.dense0, true)\r\n      out = denseBlock3(out, params.dense1)\r\n      out = denseBlock3(out, params.dense2)\r\n      out = tf.avgPool(out, [14, 14], [2, 2], 'valid')\r\n\r\n      return out\r\n    })\r\n  }\r\n\r\n  public async forward(input: TNetInput): Promise<tf.Tensor4D> {\r\n    return this.forwardInput(await toNetInput(input))\r\n  }\r\n\r\n  protected getDefaultModelName(): string {\r\n    return 'face_feature_extractor_tiny_model'\r\n  }\r\n\r\n  protected extractParamsFromWeigthMap(weightMap: tf.NamedTensorMap) {\r\n    return extractParamsFromWeigthMapTiny(weightMap)\r\n  }\r\n\r\n  protected extractParams(weights: Float32Array) {\r\n    return extractParamsTiny(weights)\r\n  }\r\n}"],"mappings":";AAAA,OAAO,KAAKA,EAAE,MAAM,uBAAuB;AAC3C,SAAmBC,aAAa,EAAEC,SAAS,EAAaC,UAAU,QAAQ,6BAA6B;AAEvG,SAASC,WAAW,QAAQ,cAAc;AAC1C,SAASC,8BAA8B,QAAQ,kCAAkC;AACjF,SAASC,iBAAiB,QAAQ,qBAAqB;AAGvD,IAAAC,wBAAA,0BAAAC,MAAA;EAA8CC,OAAA,CAAAC,SAAA,CAAAH,wBAAA,EAAAC,MAAA;EAE5C,SAAAD,yBAAA;WACEC,MAAA,CAAAG,IAAA,OAAM,0BAA0B,CAAC;EACnC;EAEOJ,wBAAA,CAAAK,SAAA,CAAAC,YAAY,GAAnB,UAAoBC,KAAe;IAEzB,IAAAC,MAAA,QAAAA,MAAM;IAEd,IAAI,CAACA,MAAM,EAAE;MACX,MAAM,IAAIC,KAAK,CAAC,wDAAwD,CAAC;;IAG3E,OAAOhB,EAAE,CAACiB,IAAI,CAAC;MACb,IAAMC,WAAW,GAAGJ,KAAK,CAACK,aAAa,CAAC,GAAG,EAAE,IAAI,CAAC;MAClD,IAAMC,OAAO,GAAG,CAAC,OAAO,EAAE,OAAO,EAAE,OAAO,CAAC;MAC3C,IAAMC,UAAU,GAAGnB,SAAS,CAACgB,WAAW,EAAEE,OAAO,CAAC,CAACE,GAAG,CAACtB,EAAE,CAACuB,MAAM,CAAC,GAAG,CAAC,CAAgB;MAErF,IAAIC,GAAG,GAAGpB,WAAW,CAACiB,UAAU,EAAEN,MAAM,CAACU,MAAM,EAAE,IAAI,CAAC;MACtDD,GAAG,GAAGpB,WAAW,CAACoB,GAAG,EAAET,MAAM,CAACW,MAAM,CAAC;MACrCF,GAAG,GAAGpB,WAAW,CAACoB,GAAG,EAAET,MAAM,CAACY,MAAM,CAAC;MACrCH,GAAG,GAAGxB,EAAE,CAAC4B,OAAO,CAACJ,GAAG,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,CAAC;MAEhD,OAAOA,GAAG;IACZ,CAAC,CAAC;EACJ,CAAC;EAEYjB,wBAAA,CAAAK,SAAA,CAAAiB,OAAO,GAApB,UAAqBf,KAAgB;;;;;;YAC5BgB,EAAA,OAAI,CAACjB,YAAY;YAAC,qBAAMV,UAAU,CAACW,KAAK,CAAC;;YAAhD,sBAAOgB,EAAA,CAAAC,KAAA,KAAI,GAAcC,EAAA,CAAAC,IAAA,EAAuB,EAAC;;;;GAClD;EAES1B,wBAAA,CAAAK,SAAA,CAAAsB,mBAAmB,GAA7B;IACE,OAAO,mCAAmC;EAC5C,CAAC;EAES3B,wBAAA,CAAAK,SAAA,CAAAuB,0BAA0B,GAApC,UAAqCC,SAA4B;IAC/D,OAAO/B,8BAA8B,CAAC+B,SAAS,CAAC;EAClD,CAAC;EAES7B,wBAAA,CAAAK,SAAA,CAAAyB,aAAa,GAAvB,UAAwBC,OAAqB;IAC3C,OAAOhC,iBAAiB,CAACgC,OAAO,CAAC;EACnC,CAAC;EACH,OAAA/B,wBAAC;AAAD,CAAC,CA3C6CN,aAAa","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}