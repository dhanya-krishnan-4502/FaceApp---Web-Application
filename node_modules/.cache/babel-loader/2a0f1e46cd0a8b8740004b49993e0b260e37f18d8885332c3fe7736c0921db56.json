{"ast":null,"code":"import * as tslib_1 from \"tslib\";\nimport * as tf from '@tensorflow/tfjs-core';\nimport { extractFaces, extractFaceTensors } from '../dom';\nimport { extendWithFaceLandmarks } from '../factories/WithFaceLandmarks';\nimport { ComposableTask } from './ComposableTask';\nimport { ComputeAllFaceDescriptorsTask, ComputeSingleFaceDescriptorTask } from './ComputeFaceDescriptorsTasks';\nimport { nets } from './nets';\nimport { PredictAllAgeAndGenderWithFaceAlignmentTask, PredictSingleAgeAndGenderWithFaceAlignmentTask } from './PredictAgeAndGenderTask';\nimport { PredictAllFaceExpressionsWithFaceAlignmentTask, PredictSingleFaceExpressionsWithFaceAlignmentTask } from './PredictFaceExpressionsTask';\nvar DetectFaceLandmarksTaskBase = /** @class */function (_super) {\n  tslib_1.__extends(DetectFaceLandmarksTaskBase, _super);\n  function DetectFaceLandmarksTaskBase(parentTask, input, useTinyLandmarkNet) {\n    var _this = _super.call(this) || this;\n    _this.parentTask = parentTask;\n    _this.input = input;\n    _this.useTinyLandmarkNet = useTinyLandmarkNet;\n    return _this;\n  }\n  Object.defineProperty(DetectFaceLandmarksTaskBase.prototype, \"landmarkNet\", {\n    get: function () {\n      return this.useTinyLandmarkNet ? nets.faceLandmark68TinyNet : nets.faceLandmark68Net;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  return DetectFaceLandmarksTaskBase;\n}(ComposableTask);\nexport { DetectFaceLandmarksTaskBase };\nvar DetectAllFaceLandmarksTask = /** @class */function (_super) {\n  tslib_1.__extends(DetectAllFaceLandmarksTask, _super);\n  function DetectAllFaceLandmarksTask() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  DetectAllFaceLandmarksTask.prototype.run = function () {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var parentResults, detections, faces, _a, faceLandmarksByFace;\n      var _this = this;\n      return tslib_1.__generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4 /*yield*/, this.parentTask];\n          case 1:\n            parentResults = _b.sent();\n            detections = parentResults.map(function (res) {\n              return res.detection;\n            });\n            if (!(this.input instanceof tf.Tensor)) return [3 /*break*/, 3];\n            return [4 /*yield*/, extractFaceTensors(this.input, detections)];\n          case 2:\n            _a = _b.sent();\n            return [3 /*break*/, 5];\n          case 3:\n            return [4 /*yield*/, extractFaces(this.input, detections)];\n          case 4:\n            _a = _b.sent();\n            _b.label = 5;\n          case 5:\n            faces = _a;\n            return [4 /*yield*/, Promise.all(faces.map(function (face) {\n              return _this.landmarkNet.detectLandmarks(face);\n            }))];\n          case 6:\n            faceLandmarksByFace = _b.sent();\n            faces.forEach(function (f) {\n              return f instanceof tf.Tensor && f.dispose();\n            });\n            return [2 /*return*/, parentResults.map(function (parentResult, i) {\n              return extendWithFaceLandmarks(parentResult, faceLandmarksByFace[i]);\n            })];\n        }\n      });\n    });\n  };\n  DetectAllFaceLandmarksTask.prototype.withFaceExpressions = function () {\n    return new PredictAllFaceExpressionsWithFaceAlignmentTask(this, this.input);\n  };\n  DetectAllFaceLandmarksTask.prototype.withAgeAndGender = function () {\n    return new PredictAllAgeAndGenderWithFaceAlignmentTask(this, this.input);\n  };\n  DetectAllFaceLandmarksTask.prototype.withFaceDescriptors = function () {\n    return new ComputeAllFaceDescriptorsTask(this, this.input);\n  };\n  return DetectAllFaceLandmarksTask;\n}(DetectFaceLandmarksTaskBase);\nexport { DetectAllFaceLandmarksTask };\nvar DetectSingleFaceLandmarksTask = /** @class */function (_super) {\n  tslib_1.__extends(DetectSingleFaceLandmarksTask, _super);\n  function DetectSingleFaceLandmarksTask() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  DetectSingleFaceLandmarksTask.prototype.run = function () {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var parentResult, detection, faces, _a, landmarks;\n      return tslib_1.__generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4 /*yield*/, this.parentTask];\n          case 1:\n            parentResult = _b.sent();\n            if (!parentResult) {\n              return [2 /*return*/];\n            }\n            detection = parentResult.detection;\n            if (!(this.input instanceof tf.Tensor)) return [3 /*break*/, 3];\n            return [4 /*yield*/, extractFaceTensors(this.input, [detection])];\n          case 2:\n            _a = _b.sent();\n            return [3 /*break*/, 5];\n          case 3:\n            return [4 /*yield*/, extractFaces(this.input, [detection])];\n          case 4:\n            _a = _b.sent();\n            _b.label = 5;\n          case 5:\n            faces = _a;\n            return [4 /*yield*/, this.landmarkNet.detectLandmarks(faces[0])];\n          case 6:\n            landmarks = _b.sent();\n            faces.forEach(function (f) {\n              return f instanceof tf.Tensor && f.dispose();\n            });\n            return [2 /*return*/, extendWithFaceLandmarks(parentResult, landmarks)];\n        }\n      });\n    });\n  };\n  DetectSingleFaceLandmarksTask.prototype.withFaceExpressions = function () {\n    return new PredictSingleFaceExpressionsWithFaceAlignmentTask(this, this.input);\n  };\n  DetectSingleFaceLandmarksTask.prototype.withAgeAndGender = function () {\n    return new PredictSingleAgeAndGenderWithFaceAlignmentTask(this, this.input);\n  };\n  DetectSingleFaceLandmarksTask.prototype.withFaceDescriptor = function () {\n    return new ComputeSingleFaceDescriptorTask(this, this.input);\n  };\n  return DetectSingleFaceLandmarksTask;\n}(DetectFaceLandmarksTaskBase);\nexport { DetectSingleFaceLandmarksTask };","map":{"version":3,"names":["tf","extractFaces","extractFaceTensors","extendWithFaceLandmarks","ComposableTask","ComputeAllFaceDescriptorsTask","ComputeSingleFaceDescriptorTask","nets","PredictAllAgeAndGenderWithFaceAlignmentTask","PredictSingleAgeAndGenderWithFaceAlignmentTask","PredictAllFaceExpressionsWithFaceAlignmentTask","PredictSingleFaceExpressionsWithFaceAlignmentTask","DetectFaceLandmarksTaskBase","_super","tslib_1","__extends","parentTask","input","useTinyLandmarkNet","_this","call","Object","defineProperty","prototype","get","faceLandmark68TinyNet","faceLandmark68Net","DetectAllFaceLandmarksTask","run","parentResults","_b","sent","detections","map","res","detection","Tensor","_a","faces","Promise","all","face","landmarkNet","detectLandmarks","faceLandmarksByFace","forEach","f","dispose","parentResult","i","withFaceExpressions","withAgeAndGender","withFaceDescriptors","DetectSingleFaceLandmarksTask","landmarks","withFaceDescriptor"],"sources":["/Users/dhanya/node_modules/face-api.js/src/globalApi/DetectFaceLandmarksTasks.ts"],"sourcesContent":["import * as tf from '@tensorflow/tfjs-core';\r\nimport { TNetInput } from 'tfjs-image-recognition-base';\r\n\r\nimport { FaceLandmarks68 } from '../classes/FaceLandmarks68';\r\nimport { extractFaces, extractFaceTensors } from '../dom';\r\nimport { FaceLandmark68Net } from '../faceLandmarkNet/FaceLandmark68Net';\r\nimport { FaceLandmark68TinyNet } from '../faceLandmarkNet/FaceLandmark68TinyNet';\r\nimport { WithFaceDetection } from '../factories/WithFaceDetection';\r\nimport { extendWithFaceLandmarks, WithFaceLandmarks } from '../factories/WithFaceLandmarks';\r\nimport { ComposableTask } from './ComposableTask';\r\nimport { ComputeAllFaceDescriptorsTask, ComputeSingleFaceDescriptorTask } from './ComputeFaceDescriptorsTasks';\r\nimport { nets } from './nets';\r\nimport {\r\n  PredictAllAgeAndGenderWithFaceAlignmentTask,\r\n  PredictSingleAgeAndGenderWithFaceAlignmentTask,\r\n} from './PredictAgeAndGenderTask';\r\nimport {\r\n  PredictAllFaceExpressionsWithFaceAlignmentTask,\r\n  PredictSingleFaceExpressionsWithFaceAlignmentTask,\r\n} from './PredictFaceExpressionsTask';\r\n\r\nexport class DetectFaceLandmarksTaskBase<TReturn, TParentReturn> extends ComposableTask<TReturn> {\r\n  constructor(\r\n    protected parentTask: ComposableTask<TParentReturn> | Promise<TParentReturn>,\r\n    protected input: TNetInput,\r\n    protected useTinyLandmarkNet: boolean\r\n  ) {\r\n    super()\r\n  }\r\n\r\n  protected get landmarkNet(): FaceLandmark68Net | FaceLandmark68TinyNet {\r\n    return this.useTinyLandmarkNet\r\n      ? nets.faceLandmark68TinyNet\r\n      : nets.faceLandmark68Net\r\n  }\r\n}\r\n\r\nexport class DetectAllFaceLandmarksTask<\r\n  TSource extends WithFaceDetection<{}>\r\n> extends DetectFaceLandmarksTaskBase<WithFaceLandmarks<TSource>[], TSource[]> {\r\n\r\n  public async run(): Promise<WithFaceLandmarks<TSource>[]> {\r\n\r\n    const parentResults = await this.parentTask\r\n    const detections = parentResults.map(res => res.detection)\r\n\r\n    const faces: Array<HTMLCanvasElement | tf.Tensor3D> = this.input instanceof tf.Tensor\r\n      ? await extractFaceTensors(this.input, detections)\r\n      : await extractFaces(this.input, detections)\r\n\r\n    const faceLandmarksByFace = await Promise.all(faces.map(\r\n      face => this.landmarkNet.detectLandmarks(face)\r\n    )) as FaceLandmarks68[]\r\n\r\n    faces.forEach(f => f instanceof tf.Tensor && f.dispose())\r\n\r\n    return parentResults.map((parentResult, i) =>\r\n      extendWithFaceLandmarks<TSource>(parentResult, faceLandmarksByFace[i])\r\n    )\r\n  }\r\n\r\n  withFaceExpressions() {\r\n    return new PredictAllFaceExpressionsWithFaceAlignmentTask(this, this.input)\r\n  }\r\n\r\n  withAgeAndGender() {\r\n    return new PredictAllAgeAndGenderWithFaceAlignmentTask(this, this.input)\r\n  }\r\n\r\n  withFaceDescriptors() {\r\n    return new ComputeAllFaceDescriptorsTask(this, this.input)\r\n  }\r\n}\r\n\r\nexport class DetectSingleFaceLandmarksTask<\r\n  TSource extends WithFaceDetection<{}>\r\n>  extends DetectFaceLandmarksTaskBase<WithFaceLandmarks<TSource> | undefined, TSource | undefined> {\r\n\r\n  public async run(): Promise<WithFaceLandmarks<TSource> | undefined> {\r\n\r\n    const parentResult = await this.parentTask\r\n    if (!parentResult) {\r\n      return\r\n    }\r\n\r\n    const { detection } = parentResult\r\n    const faces: Array<HTMLCanvasElement | tf.Tensor3D> = this.input instanceof tf.Tensor\r\n      ? await extractFaceTensors(this.input, [detection])\r\n      : await extractFaces(this.input, [detection])\r\n\r\n    const landmarks = await this.landmarkNet.detectLandmarks(faces[0]) as FaceLandmarks68\r\n\r\n    faces.forEach(f => f instanceof tf.Tensor && f.dispose())\r\n\r\n    return extendWithFaceLandmarks<TSource>(parentResult, landmarks)\r\n  }\r\n\r\n  withFaceExpressions() {\r\n    return new PredictSingleFaceExpressionsWithFaceAlignmentTask(this, this.input)\r\n  }\r\n\r\n  withAgeAndGender() {\r\n    return new PredictSingleAgeAndGenderWithFaceAlignmentTask(this, this.input)\r\n  }\r\n\r\n  withFaceDescriptor() {\r\n    return new ComputeSingleFaceDescriptorTask(this, this.input)\r\n  }\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}