{"ast":null,"code":"import * as tslib_1 from \"tslib\";\nimport { extendWithFaceDescriptor } from '../factories/WithFaceDescriptor';\nimport { ComposableTask } from './ComposableTask';\nimport { extractAllFacesAndComputeResults, extractSingleFaceAndComputeResult } from './extractFacesAndComputeResults';\nimport { nets } from './nets';\nimport { PredictAllAgeAndGenderWithFaceAlignmentTask, PredictSingleAgeAndGenderWithFaceAlignmentTask } from './PredictAgeAndGenderTask';\nimport { PredictAllFaceExpressionsWithFaceAlignmentTask, PredictSingleFaceExpressionsWithFaceAlignmentTask } from './PredictFaceExpressionsTask';\nvar ComputeFaceDescriptorsTaskBase = /** @class */function (_super) {\n  tslib_1.__extends(ComputeFaceDescriptorsTaskBase, _super);\n  function ComputeFaceDescriptorsTaskBase(parentTask, input) {\n    var _this = _super.call(this) || this;\n    _this.parentTask = parentTask;\n    _this.input = input;\n    return _this;\n  }\n  return ComputeFaceDescriptorsTaskBase;\n}(ComposableTask);\nexport { ComputeFaceDescriptorsTaskBase };\nvar ComputeAllFaceDescriptorsTask = /** @class */function (_super) {\n  tslib_1.__extends(ComputeAllFaceDescriptorsTask, _super);\n  function ComputeAllFaceDescriptorsTask() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  ComputeAllFaceDescriptorsTask.prototype.run = function () {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var parentResults, descriptors;\n      return tslib_1.__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, this.parentTask];\n          case 1:\n            parentResults = _a.sent();\n            return [4 /*yield*/, extractAllFacesAndComputeResults(parentResults, this.input, function (faces) {\n              return Promise.all(faces.map(function (face) {\n                return nets.faceRecognitionNet.computeFaceDescriptor(face);\n              }));\n            }, null, function (parentResult) {\n              return parentResult.landmarks.align(null, {\n                useDlibAlignment: true\n              });\n            })];\n          case 2:\n            descriptors = _a.sent();\n            return [2 /*return*/, descriptors.map(function (descriptor, i) {\n              return extendWithFaceDescriptor(parentResults[i], descriptor);\n            })];\n        }\n      });\n    });\n  };\n  ComputeAllFaceDescriptorsTask.prototype.withFaceExpressions = function () {\n    return new PredictAllFaceExpressionsWithFaceAlignmentTask(this, this.input);\n  };\n  ComputeAllFaceDescriptorsTask.prototype.withAgeAndGender = function () {\n    return new PredictAllAgeAndGenderWithFaceAlignmentTask(this, this.input);\n  };\n  return ComputeAllFaceDescriptorsTask;\n}(ComputeFaceDescriptorsTaskBase);\nexport { ComputeAllFaceDescriptorsTask };\nvar ComputeSingleFaceDescriptorTask = /** @class */function (_super) {\n  tslib_1.__extends(ComputeSingleFaceDescriptorTask, _super);\n  function ComputeSingleFaceDescriptorTask() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  ComputeSingleFaceDescriptorTask.prototype.run = function () {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var parentResult, descriptor;\n      return tslib_1.__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, this.parentTask];\n          case 1:\n            parentResult = _a.sent();\n            if (!parentResult) {\n              return [2 /*return*/];\n            }\n            return [4 /*yield*/, extractSingleFaceAndComputeResult(parentResult, this.input, function (face) {\n              return nets.faceRecognitionNet.computeFaceDescriptor(face);\n            }, null, function (parentResult) {\n              return parentResult.landmarks.align(null, {\n                useDlibAlignment: true\n              });\n            })];\n          case 2:\n            descriptor = _a.sent();\n            return [2 /*return*/, extendWithFaceDescriptor(parentResult, descriptor)];\n        }\n      });\n    });\n  };\n  ComputeSingleFaceDescriptorTask.prototype.withFaceExpressions = function () {\n    return new PredictSingleFaceExpressionsWithFaceAlignmentTask(this, this.input);\n  };\n  ComputeSingleFaceDescriptorTask.prototype.withAgeAndGender = function () {\n    return new PredictSingleAgeAndGenderWithFaceAlignmentTask(this, this.input);\n  };\n  return ComputeSingleFaceDescriptorTask;\n}(ComputeFaceDescriptorsTaskBase);\nexport { ComputeSingleFaceDescriptorTask };","map":{"version":3,"names":["extendWithFaceDescriptor","ComposableTask","extractAllFacesAndComputeResults","extractSingleFaceAndComputeResult","nets","PredictAllAgeAndGenderWithFaceAlignmentTask","PredictSingleAgeAndGenderWithFaceAlignmentTask","PredictAllFaceExpressionsWithFaceAlignmentTask","PredictSingleFaceExpressionsWithFaceAlignmentTask","ComputeFaceDescriptorsTaskBase","_super","tslib_1","__extends","parentTask","input","_this","call","ComputeAllFaceDescriptorsTask","prototype","run","parentResults","_a","sent","faces","Promise","all","map","face","faceRecognitionNet","computeFaceDescriptor","parentResult","landmarks","align","useDlibAlignment","descriptors","descriptor","i","withFaceExpressions","withAgeAndGender","ComputeSingleFaceDescriptorTask"],"sources":["/Users/dhanya/node_modules/face-api.js/src/globalApi/ComputeFaceDescriptorsTasks.ts"],"sourcesContent":["import { TNetInput } from 'tfjs-image-recognition-base';\r\n\r\nimport { extendWithFaceDescriptor, WithFaceDescriptor } from '../factories/WithFaceDescriptor';\r\nimport { WithFaceDetection } from '../factories/WithFaceDetection';\r\nimport { WithFaceLandmarks } from '../factories/WithFaceLandmarks';\r\nimport { ComposableTask } from './ComposableTask';\r\nimport { extractAllFacesAndComputeResults, extractSingleFaceAndComputeResult } from './extractFacesAndComputeResults';\r\nimport { nets } from './nets';\r\nimport {\r\n  PredictAllAgeAndGenderWithFaceAlignmentTask,\r\n  PredictSingleAgeAndGenderWithFaceAlignmentTask,\r\n} from './PredictAgeAndGenderTask';\r\nimport {\r\n  PredictAllFaceExpressionsWithFaceAlignmentTask,\r\n  PredictSingleFaceExpressionsWithFaceAlignmentTask,\r\n} from './PredictFaceExpressionsTask';\r\n\r\nexport class ComputeFaceDescriptorsTaskBase<TReturn, TParentReturn> extends ComposableTask<TReturn> {\r\n  constructor(\r\n    protected parentTask: ComposableTask<TParentReturn> | Promise<TParentReturn>,\r\n    protected input: TNetInput\r\n  ) {\r\n    super()\r\n  }\r\n}\r\n\r\nexport class ComputeAllFaceDescriptorsTask<\r\n  TSource extends WithFaceLandmarks<WithFaceDetection<{}>>\r\n> extends ComputeFaceDescriptorsTaskBase<WithFaceDescriptor<TSource>[], TSource[]> {\r\n\r\n  public async run(): Promise<WithFaceDescriptor<TSource>[]> {\r\n\r\n    const parentResults = await this.parentTask\r\n\r\n    const descriptors = await extractAllFacesAndComputeResults<TSource, Float32Array[]>(\r\n      parentResults,\r\n      this.input,\r\n      faces => Promise.all(faces.map(face =>\r\n        nets.faceRecognitionNet.computeFaceDescriptor(face) as Promise<Float32Array>\r\n      )),\r\n      null,\r\n      parentResult => parentResult.landmarks.align(null, { useDlibAlignment: true })\r\n    )\r\n\r\n    return descriptors.map((descriptor, i) => extendWithFaceDescriptor<TSource>(parentResults[i], descriptor))\r\n  }\r\n\r\n  withFaceExpressions() {\r\n    return new PredictAllFaceExpressionsWithFaceAlignmentTask(this, this.input)\r\n  }\r\n\r\n  withAgeAndGender() {\r\n    return new PredictAllAgeAndGenderWithFaceAlignmentTask(this, this.input)\r\n  }\r\n}\r\n\r\nexport class ComputeSingleFaceDescriptorTask<\r\n  TSource extends WithFaceLandmarks<WithFaceDetection<{}>>\r\n> extends ComputeFaceDescriptorsTaskBase<WithFaceDescriptor<TSource> | undefined, TSource | undefined> {\r\n\r\n  public async run(): Promise<WithFaceDescriptor<TSource> | undefined> {\r\n\r\n    const parentResult = await this.parentTask\r\n    if (!parentResult) {\r\n      return\r\n    }\r\n    const descriptor = await extractSingleFaceAndComputeResult<TSource, Float32Array>(\r\n      parentResult,\r\n      this.input,\r\n      face => nets.faceRecognitionNet.computeFaceDescriptor(face) as Promise<Float32Array>,\r\n      null,\r\n      parentResult => parentResult.landmarks.align(null, { useDlibAlignment: true })\r\n    )\r\n\r\n    return extendWithFaceDescriptor(parentResult, descriptor)\r\n  }\r\n\r\n  withFaceExpressions() {\r\n    return new PredictSingleFaceExpressionsWithFaceAlignmentTask(this, this.input)\r\n  }\r\n\r\n  withAgeAndGender() {\r\n    return new PredictSingleAgeAndGenderWithFaceAlignmentTask(this, this.input)\r\n  }\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}