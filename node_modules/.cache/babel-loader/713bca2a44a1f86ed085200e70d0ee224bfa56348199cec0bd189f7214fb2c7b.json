{"ast":null,"code":"import * as tslib_1 from \"tslib\";\nimport * as tf from '@tensorflow/tfjs-core';\nimport { toNetInput } from 'tfjs-image-recognition-base';\nimport { FaceFeatureExtractor } from '../faceFeatureExtractor/FaceFeatureExtractor';\nimport { FaceProcessor } from '../faceProcessor/FaceProcessor';\nimport { FaceExpressions } from './FaceExpressions';\nvar FaceExpressionNet = /** @class */function (_super) {\n  tslib_1.__extends(FaceExpressionNet, _super);\n  function FaceExpressionNet(faceFeatureExtractor) {\n    if (faceFeatureExtractor === void 0) {\n      faceFeatureExtractor = new FaceFeatureExtractor();\n    }\n    return _super.call(this, 'FaceExpressionNet', faceFeatureExtractor) || this;\n  }\n  FaceExpressionNet.prototype.forwardInput = function (input) {\n    var _this = this;\n    return tf.tidy(function () {\n      return tf.softmax(_this.runNet(input));\n    });\n  };\n  FaceExpressionNet.prototype.forward = function (input) {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var _a;\n      return tslib_1.__generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            _a = this.forwardInput;\n            return [4 /*yield*/, toNetInput(input)];\n          case 1:\n            return [2 /*return*/, _a.apply(this, [_b.sent()])];\n        }\n      });\n    });\n  };\n  FaceExpressionNet.prototype.predictExpressions = function (input) {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var netInput, out, probabilitesByBatch, predictionsByBatch;\n      var _this = this;\n      return tslib_1.__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, toNetInput(input)];\n          case 1:\n            netInput = _a.sent();\n            return [4 /*yield*/, this.forwardInput(netInput)];\n          case 2:\n            out = _a.sent();\n            return [4 /*yield*/, Promise.all(tf.unstack(out).map(function (t) {\n              return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                var data;\n                return tslib_1.__generator(this, function (_a) {\n                  switch (_a.label) {\n                    case 0:\n                      return [4 /*yield*/, t.data()];\n                    case 1:\n                      data = _a.sent();\n                      t.dispose();\n                      return [2 /*return*/, data];\n                  }\n                });\n              });\n            }))];\n          case 3:\n            probabilitesByBatch = _a.sent();\n            out.dispose();\n            predictionsByBatch = probabilitesByBatch.map(function (probabilites) {\n              return new FaceExpressions(probabilites);\n            });\n            return [2 /*return*/, netInput.isBatchInput ? predictionsByBatch : predictionsByBatch[0]];\n        }\n      });\n    });\n  };\n  FaceExpressionNet.prototype.getDefaultModelName = function () {\n    return 'face_expression_model';\n  };\n  FaceExpressionNet.prototype.getClassifierChannelsIn = function () {\n    return 256;\n  };\n  FaceExpressionNet.prototype.getClassifierChannelsOut = function () {\n    return 7;\n  };\n  return FaceExpressionNet;\n}(FaceProcessor);\nexport { FaceExpressionNet };","map":{"version":3,"names":["tf","toNetInput","FaceFeatureExtractor","FaceProcessor","FaceExpressions","FaceExpressionNet","_super","tslib_1","__extends","faceFeatureExtractor","call","prototype","forwardInput","input","_this","tidy","softmax","runNet","forward","_a","apply","_b","sent","predictExpressions","netInput","out","Promise","all","unstack","map","t","__awaiter","data","dispose","probabilitesByBatch","predictionsByBatch","probabilites","isBatchInput","getDefaultModelName","getClassifierChannelsIn","getClassifierChannelsOut"],"sources":["/Users/dhanya/node_modules/face-api.js/src/faceExpressionNet/FaceExpressionNet.ts"],"sourcesContent":["import * as tf from '@tensorflow/tfjs-core';\r\nimport { NetInput, TNetInput, toNetInput } from 'tfjs-image-recognition-base';\r\n\r\nimport { FaceFeatureExtractor } from '../faceFeatureExtractor/FaceFeatureExtractor';\r\nimport { FaceFeatureExtractorParams } from '../faceFeatureExtractor/types';\r\nimport { FaceProcessor } from '../faceProcessor/FaceProcessor';\r\nimport { FaceExpressions } from './FaceExpressions';\r\n\r\nexport class FaceExpressionNet extends FaceProcessor<FaceFeatureExtractorParams> {\r\n\r\n  constructor(faceFeatureExtractor: FaceFeatureExtractor = new FaceFeatureExtractor()) {\r\n    super('FaceExpressionNet', faceFeatureExtractor)\r\n  }\r\n\r\n  public forwardInput(input: NetInput | tf.Tensor4D): tf.Tensor2D {\r\n    return tf.tidy(() => tf.softmax(this.runNet(input)))\r\n  }\r\n\r\n  public async forward(input: TNetInput): Promise<tf.Tensor2D> {\r\n    return this.forwardInput(await toNetInput(input))\r\n  }\r\n\r\n  public async predictExpressions(input: TNetInput) {\r\n    const netInput = await toNetInput(input)\r\n    const out = await this.forwardInput(netInput)\r\n    const probabilitesByBatch = await Promise.all(tf.unstack(out).map(async t => {\r\n      const data = await t.data()\r\n      t.dispose()\r\n      return data\r\n    }))\r\n    out.dispose()\r\n\r\n    const predictionsByBatch = probabilitesByBatch\r\n      .map(probabilites => new FaceExpressions(probabilites as Float32Array))\r\n\r\n    return netInput.isBatchInput\r\n      ? predictionsByBatch\r\n      : predictionsByBatch[0]\r\n  }\r\n\r\n  protected getDefaultModelName(): string {\r\n    return 'face_expression_model'\r\n  }\r\n\r\n  protected getClassifierChannelsIn(): number {\r\n    return 256\r\n  }\r\n\r\n  protected getClassifierChannelsOut(): number {\r\n    return 7\r\n  }\r\n}"],"mappings":";AAAA,OAAO,KAAKA,EAAE,MAAM,uBAAuB;AAC3C,SAA8BC,UAAU,QAAQ,6BAA6B;AAE7E,SAASC,oBAAoB,QAAQ,8CAA8C;AAEnF,SAASC,aAAa,QAAQ,gCAAgC;AAC9D,SAASC,eAAe,QAAQ,mBAAmB;AAEnD,IAAAC,iBAAA,0BAAAC,MAAA;EAAuCC,OAAA,CAAAC,SAAA,CAAAH,iBAAA,EAAAC,MAAA;EAErC,SAAAD,kBAAYI,oBAAuE;IAAvE,IAAAA,oBAAA;MAAAA,oBAAA,OAAiDP,oBAAoB,EAAE;IAAA;WACjFI,MAAA,CAAAI,IAAA,OAAM,mBAAmB,EAAED,oBAAoB,CAAC;EAClD;EAEOJ,iBAAA,CAAAM,SAAA,CAAAC,YAAY,GAAnB,UAAoBC,KAA6B;IAAjD,IAAAC,KAAA;IACE,OAAOd,EAAE,CAACe,IAAI,CAAC;MAAM,OAAAf,EAAE,CAACgB,OAAO,CAACF,KAAI,CAACG,MAAM,CAACJ,KAAK,CAAC,CAAC;IAA9B,CAA8B,CAAC;EACtD,CAAC;EAEYR,iBAAA,CAAAM,SAAA,CAAAO,OAAO,GAApB,UAAqBL,KAAgB;;;;;;YAC5BM,EAAA,OAAI,CAACP,YAAY;YAAC,qBAAMX,UAAU,CAACY,KAAK,CAAC;;YAAhD,sBAAOM,EAAA,CAAAC,KAAA,KAAI,GAAcC,EAAA,CAAAC,IAAA,EAAuB,EAAC;;;;GAClD;EAEYjB,iBAAA,CAAAM,SAAA,CAAAY,kBAAkB,GAA/B,UAAgCV,KAAgB;;;;;;;YAC7B,qBAAMZ,UAAU,CAACY,KAAK,CAAC;;YAAlCW,QAAQ,GAAGL,EAAA,CAAAG,IAAA,EAAuB;YAC5B,qBAAM,IAAI,CAACV,YAAY,CAACY,QAAQ,CAAC;;YAAvCC,GAAG,GAAGN,EAAA,CAAAG,IAAA,EAAiC;YACjB,qBAAMI,OAAO,CAACC,GAAG,CAAC3B,EAAE,CAAC4B,OAAO,CAACH,GAAG,CAAC,CAACI,GAAG,CAAC,UAAMC,CAAC;cAAA,OAAAvB,OAAA,CAAAwB,SAAA,CAAAjB,KAAA;;;;;sBAC1D,qBAAMgB,CAAC,CAACE,IAAI,EAAE;;sBAArBA,IAAI,GAAGb,EAAA,CAAAG,IAAA,EAAc;sBAC3BQ,CAAC,CAACG,OAAO,EAAE;sBACX,sBAAOD,IAAI;;;;aACZ,CAAC,CAAC;;YAJGE,mBAAmB,GAAGf,EAAA,CAAAG,IAAA,EAIzB;YACHG,GAAG,CAACQ,OAAO,EAAE;YAEPE,kBAAkB,GAAGD,mBAAmB,CAC3CL,GAAG,CAAC,UAAAO,YAAY;cAAI,WAAIhC,eAAe,CAACgC,YAA4B,CAAC;YAAjD,CAAiD,CAAC;YAEzE,sBAAOZ,QAAQ,CAACa,YAAY,GACxBF,kBAAkB,GAClBA,kBAAkB,CAAC,CAAC,CAAC;;;;GAC1B;EAES9B,iBAAA,CAAAM,SAAA,CAAA2B,mBAAmB,GAA7B;IACE,OAAO,uBAAuB;EAChC,CAAC;EAESjC,iBAAA,CAAAM,SAAA,CAAA4B,uBAAuB,GAAjC;IACE,OAAO,GAAG;EACZ,CAAC;EAESlC,iBAAA,CAAAM,SAAA,CAAA6B,wBAAwB,GAAlC;IACE,OAAO,CAAC;EACV,CAAC;EACH,OAAAnC,iBAAC;AAAD,CAAC,CA3CsCF,aAAa","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}